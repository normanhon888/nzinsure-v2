{"breaking_changes":[{"risk":"`AUTH_SESSION_SECRET` is now mandatory, and session decoding reads it before checking whether a cookie exists; environments missing this secret can fail requests/layout rendering at runtime.","files":["platform/config/env.ts","platform/auth/session.ts","platform/auth/server.ts","app/layout.tsx"],"severity":"high"},{"risk":"Dependency baseline changed from React 19 to React 18 while staying on Next.js 16.1.6, creating a compatibility risk for release runtime/build behavior.","files":["package.json"],"severity":"high"},{"risk":"API contract changed: `/api/events` can now return `422` when rules gate blocks content, where previous flow returned success payloads.","files":["app/api/events/route.ts","lib/rules.ts"],"severity":"medium"},{"risk":"Lead submission flow now introduces lock-conflict behavior (`409 LEAD_IN_PROGRESS`), which can break callers that only handle previous success/error patterns.","files":["app/api/lead/route.ts","lib/redis-idempotency.ts"],"severity":"medium"}],"security_risks":[{"risk":"Authentication bypass: `/api/auth/login` issues a valid session cookie from caller-supplied `uid` and `role` without credential/OIDC/token verification.","files":["app/api/auth/login/route.ts","platform/auth/session.ts"],"severity":"high"},{"risk":"Login rate limiting trusts client-controlled IP headers and stores attempts in an unbounded in-memory map, enabling limit bypass and potential memory growth via spoofed IPs.","files":["app/api/auth/login/route.ts"],"severity":"medium"}],"data_migration_risks":[{"risk":"Idempotency lock is fail-open when Redis config is absent (`acquireIdempotencyLock` returns `true`), which can reintroduce duplicate lead creation and inconsistent CRM data during rollout.","files":["lib/redis-idempotency.ts","app/api/lead/route.ts"],"severity":"medium"}],"rollback_notes":["Pre-rollback check: ensure `AUTH_SESSION_SECRET` is present in all target environments before deploying auth/session changes.","If auth issues appear, first disable/rollback `app/api/auth/*` and `proxy.ts` together to avoid partial session-header behavior.","If lead processing regressions appear, rollback `app/api/lead/route.ts` and `lib/redis-idempotency.ts` as a pair to restore prior submission semantics.","`npm run lint` and `node scripts/token-guard.mjs` pass in this workspace; `npm run build` could not be fully validated here due sandbox `spawn EPERM`, so run build in CI/staging before release."]}